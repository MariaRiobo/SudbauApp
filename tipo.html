<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tipo de Tubo</title>
  <link rel="stylesheet" href="css/app.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">

</head>
<body>
  <div class="container container-large container-wide">

     <div class="header-corrosion">
      <div class="header-left">
         <img src="img/logo.png" alt="Logo de la empresa" class="logo">
         <div class="titulo-y-tubo">
         <h1 class="title">TIPO</h1>
        <p class="subtitulo-tubo">Tubo Nº <span id="numero-tubo"></span></p>
       </div>
      </div>
    </div>


    <!-- Grilla -->
  <div class="tipo-container">
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">CO</a>
    <p>Corrosión</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">DG</a>
    <p>Desgaste general</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">DC</a>
    <p>Desgaste cuña/contra</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">DP</a>
    <p>Desgaste puntual</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">TR</a>
    <p>Tubing roto</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">TT</a>
    <p>Tubing torcido</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">TP</a>
    <p>Tubing pinchado</p>
  </div>
  <div class="tipo-item">
    <a href="./cupla.html" class="tipo-btn">RV</a>
    <p>Rozamiento de varilla</p>
  </div>
  <div class="tipo-item tipo-span-2">
    <a href="./cupla.html" class="tipo-btn">UG</a>
    <p>Ungraded</p>
  </div>
</div>

    <!-- Botón inferior -->
    <div class="controles">
      <a href="./desgaste.html" class="btn-volver">Atrás</a>
    </div>

  </div>

  <script>
  /* ========= Helpers mínimos de storage ========= */
  function loadIntervencion() {
    const raw = localStorage.getItem('intervencionActual');
    if (!raw) { window.location.href = 'InicioSesion.html'; return null; }
    const itv = JSON.parse(raw);
    if (!itv.draft) itv.draft = {};       // borrador del tubo actual
    if (!itv.eventos) itv.eventos = [];   // log de eventos (opcional)
    return itv;
  }
  function saveIntervencion(itv){
    localStorage.setItem('intervencionActual', JSON.stringify(itv));
  }
  function pushEvento(tipo, extra = {}) {
    const itv = loadIntervencion(); if (!itv) return;
    itv.eventos.push({
      tipo,
      tubo: Number(itv.tuboActual),
      at: new Date().toISOString(),
      ...extra
    });
    saveIntervencion(itv);
  }

  /* ========= Estado inicial: número de tubo ========= */
  const itv = loadIntervencion();
  if (itv) {
    const numeroTuboSpan = document.getElementById('numero-tubo');
    if (numeroTuboSpan) numeroTuboSpan.textContent = itv.tuboActual;
  }

  /* ========= Guardar selección de TIPO y navegar ========= */
  document.querySelectorAll('.tipo-btn').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const code = e.currentTarget.textContent.trim(); // CO, DG, DC, ...
      const itv2 = loadIntervencion(); if (!itv2) return;

      itv2.draft.tipo = code;         // ✅ queda en draft
      saveIntervencion(itv2);

      pushEvento('tipoSeleccionado', { tipo: code }); // ✅ traza con timestamp

      // navegar a Cupla
      window.location.href = e.currentTarget.getAttribute('href'); // cupla.html
    });
  });
</script>

</body>
</html>
